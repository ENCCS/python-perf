<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Optimize &mdash; Python performance workshop  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_lesson.css?v=0c089442" />
      <link rel="stylesheet" type="text/css" href="../_static/term_role_formatting.css?v=4194e21c" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_rtd_theme_ext_color_contrast.css?v=8e8ea19f" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../_static/overrides.css?v=0572569b" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=187304be"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script src="../_static/minipres.js?v=a0d29692"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script src="../_static/design-tabs.js?v=f930bc37"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script data-domain="enccs.github.io/python-perf" defer="defer" src="https://plausible.io/js/script.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Parallelize" href="../parallelize/" />
    <link rel="prev" title="Profile" href="../profile/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            Python performance workshop
              <img src="../_static/ENCCS.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Preparation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/">Introduction and motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../perf-fundamentals/">Performance fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmark/">Benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profile/">Profile</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Optimize</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#targeting-the-most-expensive-function">Targeting the most expensive function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#option-1-changing-the-algorithm">Option 1: changing the algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#option-2-using-an-accelerator">Option 2: using an accelerator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#accelerators">Accelerators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#refactoring">Refactoring</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cython">Cython</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#when-do-we-use-accelerators">When do we use accelerators?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#an-example-astrophysics-n-body-problem">An example: Astrophysics N-body problem</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../parallelize/">Parallelize</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick-reference/">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor’s guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Python performance workshop</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Optimize</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ENCCS/content/blob/main/content/optimize.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="optimize">
<h1>Optimize<a class="headerlink" href="#optimize" title="Link to this heading"></a></h1>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Optimize the most expensive function from the word-count-hpda project’s <code class="docutils literal notranslate"><span class="pre">wordcount.py</span></code> script.</p></li>
<li><p>Show how changes to algorithm influences the performance.</p></li>
<li><p>Introduce a few Python <strong>accelerators</strong>: <code class="docutils literal notranslate"><span class="pre">cython</span></code>, <code class="docutils literal notranslate"><span class="pre">numba</span></code>, <code class="docutils literal notranslate"><span class="pre">pythran</span></code></p></li>
<li><p>Mention the library <code class="docutils literal notranslate"><span class="pre">transonic</span></code></p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>15 min teaching/demo</p></li>
<li><p>No type-along intended</p></li>
</ul>
</div>
<section id="targeting-the-most-expensive-function">
<h2>Targeting the most expensive function<a class="headerlink" href="#targeting-the-most-expensive-function" title="Link to this heading"></a></h2>
<p>In the previous episode by profiling, we found out that <code class="docutils literal notranslate"><span class="pre">update_word_counts</span></code>
consumes around half of the CPU wall time and is called repeatedly. Here is
a snippet from profiling output.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
         <span class="mi">53473208</span> <span class="n">function</span> <span class="n">calls</span> <span class="ow">in</span> <span class="mf">8.410</span> <span class="n">seconds</span>

   <span class="n">Ordered</span> <span class="n">by</span><span class="p">:</span> <span class="n">internal</span> <span class="n">time</span>

   <span class="n">ncalls</span>  <span class="n">tottime</span>  <span class="n">percall</span>  <span class="n">cumtime</span>  <span class="n">percall</span> <span class="n">filename</span><span class="p">:</span><span class="n">lineno</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
  <span class="mi">1233410</span>    <span class="mf">4.151</span>    <span class="mf">0.000</span>    <span class="mf">7.204</span>    <span class="mf">0.000</span> <span class="n">source</span><span class="o">/</span><span class="n">wordcount</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">(</span><span class="n">update_word_counts</span><span class="p">)</span>
  <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="option-1-changing-the-algorithm">
<h2>Option 1: changing the algorithm<a class="headerlink" href="#option-1-changing-the-algorithm" title="Link to this heading"></a></h2>
<p>If we look at the output from the line profiler, we can see that the following two lines
are the most time-consuming.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_word_counts</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">counts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a string, parse the string and update a dictionary of word</span>
<span class="sd">    counts (mapping words to counts of their frequencies). DELIMITERS are</span>
<span class="sd">    removed before the string is parsed. The function is case-insensitive</span>
<span class="sd">    and words in the dictionary are in lower-case.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="hll">    <span class="k">for</span> <span class="n">purge</span> <span class="ow">in</span> <span class="n">DELIMITERS</span><span class="p">:</span>
</span><span class="hll">        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">purge</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
</span>    <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="admonition-demo demo admonition" id="demo-0">
<p class="admonition-title">Demo</p>
<p>Instead of a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop and a <code class="docutils literal notranslate"><span class="pre">str.replace</span></code> we could use a single regular
expression substitution. This change would look like this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="c1"># WARNING: there is a bug in the regular expression below!</span>
<span class="n">DELIMITERS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;[\.,;:?$@^&lt;&gt;#%`!\*-=\(\)\[\]\{\}/\\\\&quot;&#39;]&quot;&quot;&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">update_word_counts</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">counts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a string, parse the string and update a dictionary of word</span>
<span class="sd">    counts (mapping words to counts of their frequencies). DELIMITERS are</span>
<span class="sd">    removed before the string is parsed. The function is case-insensitive</span>
<span class="sd">    and words in the dictionary are in lower-case.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">DELIMITERS</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>


</pre></div>
</div>
<p>If we run our benchmark with the original code (<code class="docutils literal notranslate"><span class="pre">v0.py</span></code>) and the regex version (<code class="docutils literal notranslate"><span class="pre">v0_1.py</span></code>),
we get</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">time</span><span class="w"> </span>python<span class="w"> </span>v0.py<span class="w"> </span>data/concat.txt<span class="w"> </span>processed_data/concat.dat

<span class="go">real    0m2,934s</span>
<span class="go">user    0m2,733s</span>
<span class="go">sys     0m0,191s</span>
<span class="gp">$ </span><span class="nb">time</span><span class="w"> </span>python<span class="w"> </span>v0_1.py<span class="w"> </span>data/concat.txt<span class="w"> </span>processed_data/concat.dat

<span class="go">real    0m2,472s</span>
<span class="go">user    0m2,320s</span>
<span class="go">sys     0m0,147s</span>
</pre></div>
</div>
<div class="admonition-summary discussion important admonition" id="discussion-0">
<p class="admonition-title">Summary</p>
<ul class="simple">
<li><p>There is a marginal gain of ~0.5 s which amounts to a 16% performance boost.</p></li>
<li><p>Such changes are less maintainable, but sometime necessary.</p></li>
</ul>
</div>
</div>
</section>
<section id="option-2-using-an-accelerator">
<h2>Option 2: using an accelerator<a class="headerlink" href="#option-2-using-an-accelerator" title="Link to this heading"></a></h2>
<section id="accelerators">
<h3>Accelerators<a class="headerlink" href="#accelerators" title="Link to this heading"></a></h3>
<p>The following are the few well-known accelerators for Python-Numpy applications.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 8.3%" />
<col style="width: 8.3%" />
<col style="width: 16.7%" />
<col style="width: 33.3%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Accelerator</p></th>
<th class="head"><p>Compiles</p></th>
<th class="head"><p>Implemented in</p></th>
<th class="head"><p>Level</p></th>
<th class="head"><p>Supports</p></th>
<th class="head"><p>Advantage</p></th>
</tr>
<tr class="row-even"><th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Cython</p></td>
<td><p>Ahead of time</p></td>
<td><p>C</p></td>
<td><p>Module</p></td>
<td><p>All of Python, Numpy, and C</p></td>
<td><p>Generic and can also interface C,C++</p></td>
</tr>
<tr class="row-even"><td><p>Pythran</p></td>
<td><p>Ahead of time</p></td>
<td><p>C++</p></td>
<td><p>Module</p></td>
<td><p>Most Python and Numpy features</p></td>
<td><p>Escapes GIL always, can optimize vectorized code without loops. Can parallelize using OpenMP.</p></td>
</tr>
<tr class="row-odd"><td><p>Numba</p></td>
<td><p>Just in time</p></td>
<td><p>LLVM</p></td>
<td><p>Function</p></td>
<td><p>Most Python and Numpy features</p></td>
<td><p>Specializes in Numeric codes. Has GPU support, can parallelize</p></td>
</tr>
<tr class="row-even"><td><p>Jax</p></td>
<td><p>Just in time</p></td>
<td><p>C++</p></td>
<td><p>Function or Expression</p></td>
<td><p>Most Python and Numpy features</p></td>
<td><p>Drop-in alternative for Numpy. Designed for creating ML libraries</p></td>
</tr>
<tr class="row-odd"><td><p>Cupy</p></td>
<td><p>Pre-compiled / JIT</p></td>
<td><p>Cython / C / C++</p></td>
<td><p>Function or Expression</p></td>
<td><p>Numpy and Scipy</p></td>
<td><p>Drop-in alternative for Numpy. Supports CUDA and ROCm GPUs</p></td>
</tr>
</tbody>
</table>
</section>
<section id="refactoring">
<h3>Refactoring<a class="headerlink" href="#refactoring" title="Link to this heading"></a></h3>
<p>One complication with optimizing <code class="docutils literal notranslate"><span class="pre">update_word_counts</span></code> is that it is an
impure function. In other words, it has some side-effects since it:</p>
<ol class="arabic simple">
<li><p>accesses a global variable <code class="docutils literal notranslate"><span class="pre">DELIMITERS</span></code>, and</p></li>
<li><p>mutates an external dictionary <code class="docutils literal notranslate"><span class="pre">counts</span></code> which is a local variable
inside the function <code class="docutils literal notranslate"><span class="pre">calculate_word_counts</span></code>.</p></li>
</ol>
<p>Thus the function <code class="docutils literal notranslate"><span class="pre">update_word_counts</span></code> on its own can be complicated for
an accelerator to compile since the types of the external variables are unknown.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_word_counts</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">counts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a string, parse the string and update a dictionary of word</span>
<span class="sd">    counts (mapping words to counts of their frequencies). DELIMITERS are</span>
<span class="sd">    removed before the string is parsed. The function is case-insensitive</span>
<span class="sd">    and words in the dictionary are in lower-case.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="hll">    <span class="k">for</span> <span class="n">purge</span> <span class="ow">in</span> <span class="n">DELIMITERS</span><span class="p">:</span>
</span>        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">purge</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
<span class="hll">            <span class="n">counts</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span>        <span class="k">else</span><span class="p">:</span>
<span class="hll">            <span class="n">counts</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELIMITERS</span> <span class="o">=</span> <span class="s2">&quot;. , ; : ? $ @ ^ &lt; &gt; # % ` ! * - = ( ) [ ] { } / </span><span class="se">\&quot;</span><span class="s2"> &#39;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_word_counts</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of strings, parse each string and create a dictionary of</span>
<span class="sd">    word counts (mapping words to counts of their frequencies). DELIMITERS</span>
<span class="sd">    are removed before the string is parsed. The function is</span>
<span class="sd">    case-insensitive and words in the dictionary are in lower-case.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">update_word_counts</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">counts</span>
</pre></div>
</div>
<!-- One possible way to avoid side-effects is to fold all the above
inside `calculate_word_counts` function.

:::{literalinclude} wordcount/v1_0.py
:pyobject: calculate_word_counts

::: -->
<section id="cython">
<h4>Cython<a class="headerlink" href="#cython" title="Link to this heading"></a></h4>
<p>In this example we shall demonstrate <strong>Cython</strong> via a package called
<strong>Transonic</strong> . Transonic lets you switch between Cython, Numba, Pythran and to some extent
Jax using very similar syntax</p>
<p>To use Transonic we add decorators to functions we need to optimize.
There are two decorators</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;transonic.boost</span></code> to create ahead-of-time (AOT) compiled modules and it requires type annotations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;transonic.jit</span></code> to create just-in-time (JIT) compiled modules where type is inferred on runtime</p></li>
</ul>
<p>The advantage of using transonic is that you can quickly find out which accelerator works best
while preserving the Python code for debugging and future development. It also abstracts away the
syntax variations that Cython, Pythran etc. have.</p>
<p>The accelerator backend can be chosen in 3 ways:</p>
<ol class="arabic simple">
<li><p>Using an environment variable, <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">TRANSONIC_BACKEND=cython</span></code></p></li>
<li><p>As a parameter to the decorator, <code class="docutils literal notranslate"><span class="pre">&#64;boost(backend=&quot;cython&quot;)</span></code></p></li>
<li><p>As a parameter to the Transonic CLI, <code class="docutils literal notranslate"><span class="pre">transonic</span> <span class="pre">-b</span> <span class="pre">cython</span> <span class="pre">/path/to/file.py</span></code></p></li>
</ol>
<p>We shall use the <code class="docutils literal notranslate"><span class="pre">&#64;boost</span></code> decorator and the environment variable <code class="docutils literal notranslate"><span class="pre">TRANSONIC_BACKEND</span></code> for simplicity</p>
<div class="admonition-demo demo admonition" id="demo-1">
<p class="admonition-title">Demo</p>
<p>We make a few changes to the code:</p>
<ul class="simple">
<li><p>Pull <code class="docutils literal notranslate"><span class="pre">DELIMITERS</span></code> inside <code class="docutils literal notranslate"><span class="pre">update_word_counts</span></code> function</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">&#64;boost</span></code> decorators</p></li>
<li><p>Add type annotations as <a class="reference external" href="https://transonic.readthedocs.io/en/latest/examples/type_hints.html">required by transonic</a>.</p></li>
</ul>
<p>Cython has an ability to create <em>inline functions</em> and this is also supported in Transonic. Therefore
it is OK that <code class="docutils literal notranslate"><span class="pre">update_word_counts</span></code> is impure.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">transonic</span> <span class="kn">import</span> <span class="n">boost</span>
<span class="kn">from</span> <span class="nn">transonic.typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>

<span class="nd">@boost</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">update_word_counts</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a string, parse the string and update a dictionary of word</span>
<span class="sd">    counts (mapping words to counts of their frequencies). DELIMITERS are</span>
<span class="sd">    removed before the string is parsed. The function is case-insensitive</span>
<span class="sd">    and words in the dictionary are in lower-case.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DELIMITERS</span> <span class="o">=</span> <span class="s2">&quot;. , ; : ? $ @ ^ &lt; &gt; # % ` ! * - = ( ) [ ] { } / </span><span class="se">\&quot;</span><span class="s2"> &#39;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">purge</span> <span class="ow">in</span> <span class="n">DELIMITERS</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">purge</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>

    <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>


<span class="nd">@boost</span>
<span class="k">def</span> <span class="nf">calculate_word_counts</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of strings, parse each string and create a dictionary of</span>
<span class="sd">    word counts (mapping words to counts of their frequencies). DELIMITERS</span>
<span class="sd">    are removed before the string is parsed. The function is</span>
<span class="sd">    case-insensitive and words in the dictionary are in lower-case.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">update_word_counts</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">counts</span>


</pre></div>
</div>
<p>Then compile the file <a class="reference download internal" download="" href="../_downloads/d2a19feb8735a07fd33947f1e7c1b96f/v1_1.py"><code class="xref download myst docutils literal notranslate"><span class="pre">./wordcount/v1_1.py</span></code></a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">TRANSONIC_BACKEND</span><span class="o">=</span>cython
<span class="gp">$ </span>transonic<span class="w"> </span>v1_1.py<span class="w"> </span>
<span class="go">...</span>
<span class="go">1 files created or updated needs to be cythonized</span>
<span class="gp">$ </span>ls<span class="w"> </span>-1<span class="w"> </span>__cython__/
<span class="go">build</span>
<span class="go">v1_1_ee8b793c43119b782190c854a1eb2ba7.cpython-312-x86_64-linux-gnu.so</span>
<span class="go">v1_1.pxd</span>
<span class="go">v1_1.py</span>
</pre></div>
</div>
<p>This would auto-generate a module containing only the functions to be optimized and also compiles it.
While running the application, Transonic takes care of swapping the Python function with the compiled
counterpart.</p>
<p>We are ready to benchmark this.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">time</span><span class="w"> </span>python<span class="w"> </span>v1_1.py<span class="w"> </span>data/concat.txt<span class="w"> </span>processed_data/concat.dat

<span class="go">real    0m4,071s</span>
<span class="go">user    0m4,373s</span>
<span class="go">sys     0m0,288s</span>
</pre></div>
</div>
<div class="admonition-summary discussion important admonition" id="discussion-1">
<p class="admonition-title">Summary</p>
<p><strong>We see that the compiled function made the script slower</strong>! This could happen because of a few reasons</p>
<ul class="simple">
<li><p>Python’s dictionary which uses hash-maps, is quite optimized and it is hard to beat it</p></li>
<li><p>Cython interacts with Python a lot. This can be analyzed by running <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">__cython__;</span> <span class="pre">cythonize</span> <span class="pre">--annotate</span> <span class="pre">v1_1.py</span></code>
which generates the following HTML page.</p></li>
</ul>
<p><img alt="" src="../_images/Cython_v1_1_py.png" /></p>
<ul class="simple">
<li><p>Pythran can be used to escape interaction the GIL, but it has a similar performance. Source code:
<a class="reference download internal" download="" href="../_downloads/7f6680e8fba2084ee0e2196cbcb7ea57/v1_2.py"><code class="xref download myst docutils literal notranslate"><span class="pre">./wordcount/v1_2.py</span></code></a> and <a class="reference download internal" download="" href="../_downloads/9c60462728384d671ac0af8e5fdec624/v1_2_pythran.py"><code class="xref download myst docutils literal notranslate"><span class="pre">./wordcount/v1_2_pythran.py</span></code></a></p></li>
</ul>
</div>
</div>
</section>
</section>
<section id="when-do-we-use-accelerators">
<h3>When do we use accelerators?<a class="headerlink" href="#when-do-we-use-accelerators" title="Link to this heading"></a></h3>
<section id="an-example-astrophysics-n-body-problem">
<h4>An example: Astrophysics N-body problem<a class="headerlink" href="#an-example-astrophysics-n-body-problem" title="Link to this heading"></a></h4>
<p>To simulate an <a class="reference external" href="https://en.wikipedia.org/wiki/N-body_simulation">N-body problem</a> using a naive algorithm involves
<span class="math notranslate nohighlight">\(O(N^2)\)</span> operations for each time-step. <a class="reference internal" href="../_images/Galaxy_collision.mp4"><video src="../_images/Galaxy_collision.mp4" title="" width="1"><a href="../_images/Galaxy_collision.mp4"></a></video></a></p>
<video controls width="640">
  <source src="https://enccs.github.io/python-perf/_images/Galaxy_collision.mp4" type="video/mp4" />
  <source src="//python-perf/_images/Galaxy_collision.mp4" type="video/mp4" />
  Simulation of the interactions between two galaxies as they pass by each other. The simulation contains 5000 Stars.
  Source: <https://en.wikipedia.org/wiki/File:Galaxy_collision.ogv>
</video>
<section id="naive-python-version">
<h5>Naive Python version<a class="headerlink" href="#naive-python-version" title="Link to this heading"></a></h5>
<p>It uses a list of Numpy arrays!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">perf_counter</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>


<span class="k">class</span> <span class="nc">Particle</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Particle has mass, position, velocity and acceleration.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acceleration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ke</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Cluster</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Cluster is just a list of particles with methods to accelerate and</span>
<span class="sd">    advance them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ke</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">particle</span><span class="o">.</span><span class="n">ke</span> <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ke</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pe</span>

    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__accelerate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__advance_positions</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__accelerate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__advance_velocities</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__accelerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">particle</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">particle</span><span class="o">.</span><span class="n">acceleration</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">particle</span><span class="o">.</span><span class="n">acceleration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">particle</span><span class="o">.</span><span class="n">acceleration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pe</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vector</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">p1</span><span class="o">.</span><span class="n">acceleration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p1</span><span class="o">.</span><span class="n">acceleration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">mass</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">vector</span>
            <span class="p">)</span>
            <span class="n">p2</span><span class="o">.</span><span class="n">acceleration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p2</span><span class="o">.</span><span class="n">acceleration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">mass</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">vector</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pe</span> <span class="o">-=</span> <span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="n">p2</span><span class="o">.</span><span class="n">mass</span><span class="p">)</span> <span class="o">/</span> <span class="n">distance</span>

    <span class="k">def</span> <span class="nf">__advance_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">velocity</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">acceleration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__advance_velocities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">p</span><span class="o">.</span><span class="n">velocity</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">acceleration</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">acceleration</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">t_start</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">tend</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.001</span>  <span class="c1"># end time, timestep</span>
    <span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_file</span><span class="p">:</span>
            <span class="c1"># try/except is a blunt instrument to clean up input</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Particle</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]]))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="n">old_energy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.25</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">tend</span> <span class="o">/</span> <span class="n">dt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">100</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;t = </span><span class="si">{</span><span class="n">dt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">step</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, E = </span><span class="si">{</span><span class="n">cluster</span><span class="o">.</span><span class="n">energy</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;dE/E = </span><span class="si">{</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">energy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">old_energy</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">old_energy</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">old_energy</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">energy</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final dE/E = </span><span class="si">{</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">energy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.25</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="o">-</span><span class="mf">0.25</span><span class="si">:</span><span class="s2">.6e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;run in </span><span class="si">{</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">perf_counter</span><span class="p">()</span><span class="o">-</span><span class="n">t_start</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="numpy-vectorized-version">
<h5>Numpy vectorized version<a class="headerlink" href="#numpy-vectorized-version" title="Link to this heading"></a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">perf_counter</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="k">def</span> <span class="nf">load_input_data</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">path</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;vx&quot;</span><span class="p">,</span> <span class="s2">&quot;vy&quot;</span><span class="p">,</span> <span class="s2">&quot;vz&quot;</span><span class="p">],</span> <span class="n">delimiter</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span>
    <span class="p">)</span>
    <span class="c1"># warning: copy() is for Pythran...</span>
    <span class="n">masses</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;mass&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">velocities</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;vx&quot;</span><span class="p">,</span> <span class="s2">&quot;vy&quot;</span><span class="p">,</span> <span class="s2">&quot;vz&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">masses</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">velocities</span>


<span class="k">def</span> <span class="nf">advance_positions</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">velocities</span><span class="p">,</span> <span class="n">accelerations</span><span class="p">,</span> <span class="n">time_step</span><span class="p">):</span>
    <span class="n">positions</span> <span class="o">+=</span> <span class="n">time_step</span> <span class="o">*</span> <span class="n">velocities</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">time_step</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">accelerations</span>


<span class="k">def</span> <span class="nf">advance_velocities</span><span class="p">(</span><span class="n">velocities</span><span class="p">,</span> <span class="n">accelerations</span><span class="p">,</span> <span class="n">accelerations1</span><span class="p">,</span> <span class="n">time_step</span><span class="p">):</span>
    <span class="n">velocities</span> <span class="o">+=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">time_step</span> <span class="o">*</span> <span class="p">(</span><span class="n">accelerations</span> <span class="o">+</span> <span class="n">accelerations1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">compute_accelerations</span><span class="p">(</span><span class="n">accelerations</span><span class="p">,</span> <span class="n">masses</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
    <span class="n">nb_particules</span> <span class="o">=</span> <span class="n">masses</span><span class="o">.</span><span class="n">size</span>
    <span class="k">for</span> <span class="n">index_p0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_particules</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">position0</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">index_p0</span><span class="p">]</span>
        <span class="n">mass0</span> <span class="o">=</span> <span class="n">masses</span><span class="p">[</span><span class="n">index_p0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index_p1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index_p0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_particules</span><span class="p">):</span>
            <span class="n">mass1</span> <span class="o">=</span> <span class="n">masses</span><span class="p">[</span><span class="n">index_p1</span><span class="p">]</span>
            <span class="n">vector</span> <span class="o">=</span> <span class="n">position0</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="n">index_p1</span><span class="p">]</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">vector</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">coef</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">**</span> <span class="mi">3</span>
            <span class="n">accelerations</span><span class="p">[</span><span class="n">index_p0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">mass1</span> <span class="o">*</span> <span class="n">vector</span>
            <span class="n">accelerations</span><span class="p">[</span><span class="n">index_p1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">mass0</span> <span class="o">*</span> <span class="n">vector</span>


<span class="k">def</span> <span class="nf">loop</span><span class="p">(</span><span class="n">time_step</span><span class="p">,</span> <span class="n">nb_steps</span><span class="p">,</span> <span class="n">masses</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">velocities</span><span class="p">):</span>
    <span class="n">accelerations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
    <span class="n">accelerations1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>

    <span class="n">compute_accelerations</span><span class="p">(</span><span class="n">accelerations</span><span class="p">,</span> <span class="n">masses</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>

    <span class="n">time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">energy0</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_energies</span><span class="p">(</span><span class="n">masses</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">velocities</span><span class="p">)</span>
    <span class="n">energy_previous</span> <span class="o">=</span> <span class="n">energy0</span>

    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_steps</span><span class="p">):</span>
        <span class="n">advance_positions</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">velocities</span><span class="p">,</span> <span class="n">accelerations</span><span class="p">,</span> <span class="n">time_step</span><span class="p">)</span>
        <span class="c1"># swap acceleration arrays</span>
        <span class="n">accelerations</span><span class="p">,</span> <span class="n">accelerations1</span> <span class="o">=</span> <span class="n">accelerations1</span><span class="p">,</span> <span class="n">accelerations</span>
        <span class="n">accelerations</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">compute_accelerations</span><span class="p">(</span><span class="n">accelerations</span><span class="p">,</span> <span class="n">masses</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>
        <span class="n">advance_velocities</span><span class="p">(</span><span class="n">velocities</span><span class="p">,</span> <span class="n">accelerations</span><span class="p">,</span> <span class="n">accelerations1</span><span class="p">,</span> <span class="n">time_step</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">time_step</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">energy</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_energies</span><span class="p">(</span><span class="n">masses</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">velocities</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;t = </span><span class="si">{</span><span class="n">time_step</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">step</span><span class="si">:</span><span class="s2">5.2f</span><span class="si">}</span><span class="s2">, E = </span><span class="si">{</span><span class="n">energy</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;dE/E = </span><span class="si">{</span><span class="p">(</span><span class="n">energy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">energy_previous</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">energy_previous</span><span class="si">:</span><span class="s2">+.10f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">energy_previous</span> <span class="o">=</span> <span class="n">energy</span>

    <span class="k">return</span> <span class="n">energy</span><span class="p">,</span> <span class="n">energy0</span>


<span class="k">def</span> <span class="nf">compute_kinetic_energy</span><span class="p">(</span><span class="n">masses</span><span class="p">,</span> <span class="n">velocities</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">masses</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">velocities</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">compute_potential_energy</span><span class="p">(</span><span class="n">masses</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
    <span class="n">nb_particules</span> <span class="o">=</span> <span class="n">masses</span><span class="o">.</span><span class="n">size</span>
    <span class="n">pe</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">index_p0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_particules</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">index_p1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index_p0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_particules</span><span class="p">):</span>
            <span class="n">mass0</span> <span class="o">=</span> <span class="n">masses</span><span class="p">[</span><span class="n">index_p0</span><span class="p">]</span>
            <span class="n">mass1</span> <span class="o">=</span> <span class="n">masses</span><span class="p">[</span><span class="n">index_p1</span><span class="p">]</span>
            <span class="n">vector</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">index_p0</span><span class="p">]</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="n">index_p1</span><span class="p">]</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">vector</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">pe</span> <span class="o">-=</span> <span class="p">(</span><span class="n">mass0</span> <span class="o">*</span> <span class="n">mass1</span><span class="p">)</span> <span class="o">/</span> <span class="n">distance</span>
    <span class="k">return</span> <span class="n">pe</span>


<span class="k">def</span> <span class="nf">compute_energies</span><span class="p">(</span><span class="n">masses</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">velocities</span><span class="p">):</span>
    <span class="n">energy_kin</span> <span class="o">=</span> <span class="n">compute_kinetic_energy</span><span class="p">(</span><span class="n">masses</span><span class="p">,</span> <span class="n">velocities</span><span class="p">)</span>
    <span class="n">energy_pot</span> <span class="o">=</span> <span class="n">compute_potential_energy</span><span class="p">(</span><span class="n">masses</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">energy_kin</span> <span class="o">+</span> <span class="n">energy_pot</span><span class="p">,</span> <span class="n">energy_kin</span><span class="p">,</span> <span class="n">energy_pot</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="kn">import</span> <span class="nn">sys</span>

    <span class="n">t_start</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">time_end</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">time_end</span> <span class="o">=</span> <span class="mf">10.</span>

    <span class="n">time_step</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="n">nb_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_end</span> <span class="o">/</span> <span class="n">time_step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">path_input</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">masses</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">velocities</span> <span class="o">=</span> <span class="n">load_input_data</span><span class="p">(</span><span class="n">path_input</span><span class="p">)</span>

    <span class="n">energy</span><span class="p">,</span> <span class="n">energy0</span> <span class="o">=</span> <span class="n">loop</span><span class="p">(</span><span class="n">time_step</span><span class="p">,</span> <span class="n">nb_steps</span><span class="p">,</span> <span class="n">masses</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">velocities</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final dE/E = </span><span class="si">{</span><span class="p">(</span><span class="n">energy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">energy0</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">energy0</span><span class="si">:</span><span class="s2">.6e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nb_steps</span><span class="si">}</span><span class="s2"> time steps run in </span><span class="si">{</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">perf_counter</span><span class="p">()</span><span class="o">-</span><span class="n">t_start</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="admonition-demo demo admonition" id="demo-2">
<p class="admonition-title">Demo</p>
<p><strong>Data</strong> for 16-bodies: <a class="reference download internal" download="" href="../_downloads/9cfa6afa7ceca310ad2ed7dcdd4c1554/input16"><code class="xref download myst docutils literal notranslate"><span class="pre">./nbabel/input16</span></code></a></p>
<ul class="simple">
<li><p>Naive Python version: <a class="reference download internal" download="" href="../_downloads/7003169de40f9af4b6af90f776eabaf5/bench0.py"><code class="xref download myst docutils literal notranslate"><span class="pre">./nbabel/bench0.py</span></code></a></p></li>
<li><p>Numpy vectorized version: <a class="reference download internal" download="" href="../_downloads/a19e4957ee72484794a498c304b54289/bench_numpy_highlevel.py"><code class="xref download myst docutils literal notranslate"><span class="pre">./nbabel/bench_numpy_highlevel.py</span></code></a></p></li>
<li><p>Numpy vectorized version + JIT compilation using Transonic and Pythran: <a class="reference download internal" download="" href="../_downloads/8a2cf0d814f53c320a9bd61d892dbd1f/bench_numpy_highlevel_jit.py"><code class="xref download myst docutils literal notranslate"><span class="pre">./nbabel/bench_numpy_highlevel_jit.py</span></code></a></p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">time</span><span class="w"> </span>python<span class="w"> </span>bench0.py<span class="w"> </span>input16
<span class="gp">$ </span><span class="nb">time</span><span class="w"> </span>bench_numpy_highlevel.py<span class="w"> </span>input16
<span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">TRANSONIC_BACKEND</span><span class="o">=</span>pythran
<span class="gp">$ </span><span class="nb">time</span><span class="w"> </span>bench_numpy_highlevel_jit.py<span class="w"> </span>input16<span class="w">  </span><span class="c1"># Rerun after Pythran module is compiled</span>
</pre></div>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">time</span><span class="w"> </span>python<span class="w"> </span>bench0.py<span class="w"> </span>input16
<span class="go">...</span>
<span class="go">run in 0:00:12.637249</span>

<span class="gp">$ </span><span class="nb">time</span><span class="w"> </span>bench_numpy_highlevel.py<span class="w"> </span>input16
<span class="go">...</span>
<span class="go">10001 time steps run in 0:00:04.297485</span>

<span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">TRANSONIC_BACKEND</span><span class="o">=</span>pythran
<span class="gp">$ </span><span class="nb">time</span><span class="w"> </span>bench_numpy_highlevel_jit.py<span class="w"> </span>input16<span class="w">  </span><span class="c1"># Rerun after Pythran module is compiled</span>
<span class="go">...</span>
<span class="go">10001 time steps run in 0:00:00.042925</span>
</pre></div>
</div>
<p>~300x speedup by using Pythran!</p>
</div>
</div>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Algortihmic optimizations are often better</p></li>
<li><p>Accelerators work well with contiguous data structures</p></li>
<li><p>The word-count problem is a poor candidate, but when it involves
contiguous data structures such as arrays of numbers
these accelerators can give amazing performance boosts. See here:</p>
<ul>
<li><p><a class="reference external" href="https://enccs.github.io/hpda-python/performance-boosting/">https://enccs.github.io/hpda-python/performance-boosting/</a></p></li>
<li><p><a class="reference external" href="https://github.com/paugier/nbabel/">https://github.com/paugier/nbabel/</a></p></li>
</ul>
</li>
</ul>
</div>
</section>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../profile/" class="btn btn-neutral float-left" title="Profile" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../parallelize/" class="btn btn-neutral float-right" title="Parallelize" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, ENCCS and individual contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>